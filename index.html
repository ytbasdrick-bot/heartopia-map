<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Maptopia FR - Officiel (Rex Full Restoration)</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body { 
            margin: 0; padding: 0; 
            background: url('Heartopia.jpg') no-repeat center center fixed; 
            background-size: cover; overflow: hidden; font-family: 'Segoe UI', Roboto, sans-serif; 
        }

        /* --- √âCRAN D'ACCUEIL --- */
        #intro-screen {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: black; z-index: 20000; display: flex; align-items: flex-end; 
            justify-content: center; transition: opacity 1s ease;
        }
        .video-bg-blur { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; filter: blur(20px) brightness(0.4); }
        #intro-video { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: contain; z-index: 2; border-left: 2px solid #d4af37; border-right: 2px solid #d4af37; }
        .welcome-box { 
            position: relative; bottom: 8%; width: 500px; padding: 30px; 
            background: rgba(0, 0, 0, 0.85); border: 2px solid #d4af37; border-radius: 20px; 
            color: white; z-index: 10; backdrop-filter: blur(10px); text-align: center; 
        }
        .welcome-box h1 { margin: 0; font-size: 30px; letter-spacing: 3px; color: #fff; text-transform: uppercase; text-shadow: 0 0 10px rgba(212, 175, 55, 0.5); }
        .welcome-subtitle { color: #d4af37; font-size: 18px; margin: 15px 0 5px 0; display: block; font-weight: bold; line-height: 1.4; }
        .dev-status { color: #cfcfcf; font-size: 13px; font-style: italic; margin-bottom: 25px; display: block; opacity: 0.8; }
        #enter-button { padding: 15px 45px; background: linear-gradient(135deg, #8b0000, #d4af37); color: white; border: 1px solid white; border-radius: 50px; font-size: 18px; font-weight: bold; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 0 15px rgba(139, 0, 0, 0.4); }

        /* --- CARTE --- */
        #map { height: 100vh; width: 100vw; opacity: 0; transition: opacity 2s ease; background: transparent !important; }

        /* --- MENU & SCROLL --- */
        .leaflet-control-layers {
            left: 20px !important; top: 20px !important; width: 300px !important;
            background: rgba(255, 255, 255, 0.98) !important; border-radius: 15px !important; 
            padding: 10px !important; box-shadow: 0 4px 20px rgba(0,0,0,0.5) !important;
            max-height: 80vh; overflow-y: auto !important; border: none !important; z-index: 1000;
        }
        .leaflet-control-layers::-webkit-scrollbar { width: 8px; }
        .leaflet-control-layers::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        .leaflet-control-layers::-webkit-scrollbar-thumb { background: #888; border-radius: 10px; }
        
        .accordion-title { color: white; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold; margin-bottom: 5px; text-align: center; font-size: 13px; text-transform: uppercase; }
        .title-pnj { background: #8b0000; }
        .title-bus { background: #2980b9; }
        .title-shop { background: #9b59b6; }
        .title-lieux { background: #27ae60; }
        .title-poisson { background: #f39c12; }
        .accordion-content { display: none; padding: 5px 0; }
        .accordion-content.active { display: block; }
        .menu-item { display: flex; align-items: center; padding: 10px; cursor: pointer; font-size: 13px; border-bottom: 1px solid #eee; color: #333; }
        .menu-icon { width: 24px; height: 24px; margin-right: 10px; object-fit: contain; }

        /* --- LABELS --- */
        .label-ville { background: white !important; border: 2px solid #3498db !important; border-radius: 5px; padding: 2px 8px; font-weight: bold; font-size: 11px; color: #2980b9; }
        .label-eau { background: rgba(41, 128, 185, 0.2) !important; border: 1px solid #2980b9 !important; border-radius: 5px; padding: 2px 8px; font-size: 10px; color: white; text-shadow: 1px 1px 2px black; }

        /* --- UI ELEMENTS --- */
        .team-box { position: fixed; bottom: 70px; left: 20px; z-index: 3000; text-align: center; }
        .team-text { font-weight: 900; font-size: 18px; background: linear-gradient(to right, #ffffff, #d4af37, #ffffff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; display: block; margin-bottom: 5px; }
        .team-img { width: 90px; height: 90px; border-radius: 15px; border: 2px solid #d4af37; cursor: pointer; transition: 0.3s; object-fit: cover; }
        .discord-box { position: fixed; bottom: 75px; right: 20px; z-index: 3000; }
        .discord-btn { background: #5865F2; color: white; padding: 12px 20px; border-radius: 15px; display: flex; align-items: center; text-decoration: none; font-weight: bold; }
        .discord-btn img { width: 30px; margin-right: 10px; }
        .footer-wiki { position: fixed; bottom: 0; left: 0; width: 100%; height: 55px; z-index: 3000; background: linear-gradient(90deg, #8b0000, #d4af37, #8b0000); display: flex; align-items: center; justify-content: center; border-top: 2px solid white; }
        #overlay-fish, #overlay-team { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 30000; display: none; align-items: center; justify-content: center; }
        .fish-display-wrapper { display: flex; flex-direction: column; align-items: center; width: 90%; max-width: 700px; background: white; border-radius: 20px; overflow: hidden; border: 3px solid #d4af37; }
    </style>
</head>
<body>

<video id="entry-sound" style="display:none;"><source src="sonheartopia.mp4" type="video/mp4"></video>

<div id="intro-screen">
    <video class="video-bg-blur" autoplay muted loop playsinline><source src="pere noel.mp4" type="video/mp4"></video>
    <video id="intro-video" autoplay muted loop playsinline><source src="pere noel.mp4" type="video/mp4"></video>
    <div class="welcome-box">
        <h1>MAPTOPIA FR</h1>
        <span class="welcome-subtitle">L'outil ultime pour Heartopia.</span>
        <span class="dev-status">Astuce : Fais un CLIC DROIT pour tes notes persos.</span>
        <button id="enter-button" onclick="startExperience()">üéÑ ENTRER üéÑ</button>
    </div>
</div>

<div id="map"></div>

<div class="team-box">
    <span class="team-text">TEAM HEART FR</span>
    <img src="groupefr.png" class="team-img" onclick="document.getElementById('overlay-team').style.display='flex'">
</div>

<div class="discord-box">
    <a href="https://discord.gg/dc8eZwf2jq" target="_blank" class="discord-btn"><img src="Discord-Logo-PNG-Pic.png"> REJOINDRE LE DISCORD</a>
</div>

<div id="overlay-team" onclick="this.style.display='none'"><img src="groupefr.png"></div>
<div id="overlay-fish" onclick="this.style.display='none'"><div class="fish-display-wrapper"><img id="fish-main" style="width:100%"><img id="fish-cond" style="width:100%"></div></div>
<div class="footer-wiki"><a href="https://jayibwi.wixsite.com/my-site-1" target="_blank" style="color:white; text-decoration:none; font-weight:bold; font-size:18px;">üìñ ACC√âDER AU WIKI FR COMPLET üìñ</a></div>

<script>
    function startExperience() {
        var sound = document.getElementById('entry-sound');
        sound.play().catch(e => console.log("Audio bloqu√©"));
        document.getElementById('intro-screen').style.opacity = '0';
        document.getElementById('map').style.opacity = '1';
        setTimeout(() => { document.getElementById('intro-screen').style.display = 'none'; }, 1000);
    }

    var bounds = [[-1000, 0], [0, 1000]];
    var map = L.map('map', { crs: L.CRS.Simple, minZoom: 0, maxZoom: 3, zoom: 1, maxBounds: bounds });
    L.imageOverlay('carte.png', bounds).addTo(map);
    map.setView([-500, 500], 1);

    // --- SYST√àME DE PING ---
    var userPings = JSON.parse(localStorage.getItem('maptopia_pings')) || [];
    var pingMarkers = {};

    function createPing(latlng, text, isNew) {
        var id = isNew ? Date.now() : (latlng.lat.toFixed(2) + "_" + latlng.lng.toFixed(2));
        var marker = L.marker(latlng).addTo(map);
        pingMarkers[id] = marker;
        var div = document.createElement('div');
        div.className = "ping-popup-content";
        if (isNew) {
            div.innerHTML = `<input type="text" id="in-${id}" placeholder="Note..."><br>
                             <button style="background:#27ae60;color:white;border:none;padding:5px;cursor:pointer;" onclick="confirmPing('${id}', ${latlng.lat}, ${latlng.lng})">OK</button>
                             <button style="background:#e74c3c;color:white;border:none;padding:5px;cursor:pointer;" onclick="removePing('${id}', false)">Annuler</button>`;
        } else {
            div.innerHTML = `<b>Ma Note :</b><br>${text}<br>
                             <button style="background:#e74c3c;color:white;border:none;padding:5px;cursor:pointer;" onclick="removePing('${id}', true)">Supprimer</button>`;
        }
        marker.bindPopup(div);
        if (isNew) marker.openPopup();
    }

    window.confirmPing = function(id, lat, lng) {
        var val = document.getElementById('in-' + id).value;
        if (val) {
            userPings.push({ id: id, latlng: {lat: lat, lng: lng}, text: val });
            localStorage.setItem('maptopia_pings', JSON.stringify(userPings));
            map.removeLayer(pingMarkers[id]);
            createPing({lat: lat, lng: lng}, val, false);
        }
    };

    window.removePing = function(id, fromStorage) {
        if (pingMarkers[id]) map.removeLayer(pingMarkers[id]);
        if (fromStorage) {
            userPings = userPings.filter(p => p.id != id);
            localStorage.setItem('maptopia_pings', JSON.stringify(userPings));
        }
    };

    map.on('contextmenu', (e) => createPing(e.latlng, "", true));
    userPings.forEach(p => createPing(p.latlng, p.text, false));

    // --- DONN√âES ---
    var dataStorage = { pnj:[], bus:[], shop:[], lieux:[] };
    var currentActiveLayer = null;

    function register(cat, pos, name, img, options = {}) {
        var g = L.layerGroup();
        if(options.type) { 
            L.marker(pos, {opacity:0}).addTo(g).bindTooltip(name, {permanent:true, direction:'center', className:options.type}); 
        } else { 
            var size = (cat === 'shop') ? 60 : 70;
            L.marker(pos, {icon: L.icon({iconUrl:img, iconSize:[size,size], iconAnchor:[size/2,size]})}).addTo(g).bindPopup(name); 
        }
        if(options.startOn) g.addTo(map);
        dataStorage[cat].push({name:name, pos:pos, layer:g, img:img, startOn: options.startOn});
    }

    // PNJ
    [
        ["Bob",[-471,501],'pnj/bob.png'], ["Atara",[-526,499],'pnj/atara.png'], ["Collectionneur",[-478,493],'pnj/collectioneur.png'], 
        ["Doroth√©e",[-469,488],'pnj/doroth√©e.png'], ["Massimo",[-446,493],'pnj/massimo.png'], ["Andrew",[-399,591],'pnj/andrew.png'], 
        ["Eric",[-259,522],'pnj/eric.png'], ["Vanya",[-456,549],'pnj/vanya.png'], ["Naniwa",[-502,582],'pnj/niniwa.png'], 
        ["Joan",[-502,519],'pnj/joa.png'], ["Will",[-807,419],'pnj/will.png'], ["Patti",[-355,809],'pnj/patti.png'], 
        ["Vernie",[-653,225],'pnj/vernie.png'], ["Bayley",[-498,526],'pnj/bayley.png']
    ].forEach(p => register('pnj', p[1], p[0], p[2]));

    // BUS
    [
        ["Banlieue Ouest",[-533,340]], ["Banlieue Village",[-519,639]], ["Village P√™cheurs",[-654,479]], 
        ["Champ Fleurs",[-532,218]], ["Montagne Thermale",[-222,512]], ["Banlieue Nord",[-373,480]], 
        ["Place Centrale",[-497,481]], ["For√™t",[-500,798]]
    ].forEach(b => register('bus', b[1], b[0], 'bus.png'));

    // LIEUX (35)
    var lieuxData = [
        { pos: [-538, 492], name: "Place Centrale", type: "label-ville", startOn: true },
        { pos: [-692, 506], name: "Village de P√™cheurs", type: "label-ville", startOn: true },
        { pos: [-438, 513], name: "Village", type: "label-ville", startOn: true },
        { pos: [-649, 185], name: "Champ de Fleurs", type: "label-ville", startOn: true },
        { pos: [-440, 184], name: "Montagne de Baleine", type: "label-ville", startOn: true },
        { pos: [-184, 291], name: "Les Ruines", type: "label-ville", startOn: true },
        { pos: [-223, 501], name: "Montagne Thermale", type: "label-ville", startOn: true },
        { pos: [-228, 627], name: "Falaise Rocheuse", type: "label-ville", startOn: true },
        { pos: [-531, 805], name: "For√™t de Ch√™nes Spirituels", type: "label-ville", startOn: true },
        { pos: [-494, 429], name: "Rue des Arts", type: "label-ville", startOn: true },
        { pos: [-510, 558], name: "Rue du Jardin", type: "label-ville", startOn: true },
        { pos: [-736, 602], name: "Quai Oriental", type: "label-ville", startOn: true },
        { pos: [-690, 402], name: "Quai", type: "label-ville", startOn: true },
        { pos: [-780, 387], name: "Phare", type: "label-ville", startOn: true },
        { pos: [-691, 783], name: "Tremplin", type: "label-ville", startOn: true },
        { pos: [-338, 933], name: "√éle de la For√™t", type: "label-ville", startOn: true },
        { pos: [-587, 406], name: "Banlieue", type: "label-ville", startOn: true },
        { pos: [-725, 208], name: "Plage Violette", type: "label-ville", startOn: true },
        { pos: [-783, 478], name: "Mer Calme", type: "label-eau", startOn: true },
        { pos: [-534, 92], name: "Mer de Baleine", type: "label-eau", startOn: true },
        { pos: [-68, 497], name: "Ancienne Mer", type: "label-eau", startOn: true },
        { pos: [-536, 232], name: "Lac dans la Prairie", type: "label-eau", startOn: true },
        { pos: [-337, 319], name: "Rivi√®re Aurore", type: "label-eau", startOn: true },
        { pos: [-176, 394], name: "Lac Volcanique", type: "label-eau", startOn: true },
        { pos: [-265, 537], name: "Lac Thermale", type: "label-eau", startOn: true },
        { pos: [-344, 652], name: "Rivi√®re Peu Profonde", type: "label-eau", startOn: true },
        { pos: [-598, 748], name: "Lac de la For√™t", type: "label-eau", startOn: true },
        { pos: [-431, 774], name: "Lac de la For√™t (Haut)", type: "label-eau", startOn: true },
        { pos: [-608, 481], name: "Lac de Banlieue", type: "label-eau", startOn: true },
        { pos: [-669, 368], name: "Rivi√®re Calme", type: "label-eau", startOn: true },
        { pos: [-674, 627], name: "Fleuve d'Arbres G√©ants", type: "label-eau", startOn: true },
        { pos: [-472, 487], name: "Magasin de V√™tement", icon: 'vetement.png', isShop: true },
        { pos: [-474, 503], name: "Magasin de Meuble", icon: 'Meuble.png', isShop: true },
        { pos: [-496, 523], name: "Magasin Animaux", icon: 'chien.png', isShop: true },
        { pos: [-440, 467], name: "Librairie", icon: 'Librairie.png', isShop: true }
    ];
    lieuxData.forEach(l => register(l.isShop ? 'shop' : 'lieux', l.pos, l.name, l.icon || '', {type: l.type, startOn: l.startOn}));

    // POISSONS (97)
    const fishList = [
        { name: "Ablette", bg: "poisson/ablette1.png", cond: "poisson/Lacs.png" },
        { name: "Acantharchus pomotis", bg: "poisson/Acantharchus_pomotis1.png", cond: "poisson/arcantharcus%20pomotis.png" },
        { name: "Anguille europ√©enne", bg: "VIDE", cond: "VIDE" },
        { name: "Aphyosemion striatum", bg: "poisson/Aphyosemion%20striatum.png", cond: "poisson/Aphyosemion%20striatum1.png" },
        { name: "Barbeau", bg: "poisson/barbeau1.png", cond: "poisson/barbeau.png" },
        { name: "Barbillon", bg: "poisson/barbillon1.png", cond: "poisson/barbillon.png" },
        { name: "Baudroie", bg: "poisson/baudroie1.png", cond: "poisson/Baudroie.png" },
        { name: "Bernard l'Hermite", bg: "VIDE", cond: "poisson/bernardlhermite.png" },
        { name: "Blennie de rivi√®re", bg: "VIDE", cond: "poisson/bleniiedesrivieree.png" },
        { name: "Bonite", bg: "poisson/bonite1.png", cond: "poisson/bonite.png" },
        { name: "Carpe argent√©e", bg: "poisson/carpe_argentee1.png", cond: "poisson/carpe_argentee.png" },
        { name: "Carpe europ√©enne", bg: "poisson/Carpe_europeenne1.png", cond: "poisson/Carpe_europeenne.png" },
        { name: "Carpe Papillon", bg: "poisson/carpe%20papillon1.png", cond: "poisson/carpe%20papillon.png" },
        { name: "Carpe noire", bg: "poisson/carpe%20noir.png", cond: "poisson/carpe%20noir1.png" },
        { name: "Chabot", bg: "VIDE", cond: "poisson/chabot.png" },
        { name: "Chim√®re argent√©e", bg: "poisson/chimere%20argent1.pnj.avif", cond: "poisson/chimere%20argent%C3%A9.png" },
        { name: "Com√®te coussut", bg: "poisson/comete_coussut1.png", cond: "poisson/comete_coussut.png" },
        { name: "Crabe de ruisseau", bg: "poisson/Crabe_de_ruisseau1.png", cond: "poisson/crabe%20de%20ruisseau.png" },
        { name: "Crevette de la mer", bg: "VIDE", cond: "VIDE" },
        { name: "Crevette verte", bg: "poisson/crevette_verte1.png", cond: "poisson/crevette%20verte.png" },
        { name: "Ecrevisse noble", bg: "VIDE", cond: "VIDE" },
        { name: "Ecrevisse noble bleue", bg: "VIDE", cond: "VIDE" },
        { name: "Eglefin", bg: "VIDE", cond: "VIDE" },
        { name: "Eperlan", bg: "VIDE", cond: "VIDE" },
        { name: "Epinoche", bg: "VIDE", cond: "VIDE" },
        { name: "Espadon", bg: "VIDE", cond: "VIDE" },
        { name: "F√©ra", bg: "VIDE", cond: "VIDE" },
        { name: "Grand black-basse", bg: "VIDE", cond: "VIDE" },
        { name: "Grande hu√Ætre perli√®re", bg: "VIDE", cond: "VIDE" },
        { name: "Grenouille europ√©enne", bg: "VIDE", cond: "VIDE" },
        { name: "Gobie", bg: "VIDE", cond: "VIDE" },
        { name: "Grondin perlon", bg: "VIDE", cond: "VIDE" },
        { name: "Hippocampe", bg: "VIDE", cond: "VIDE" },
        { name: "Huchon", bg: "VIDE", cond: "VIDE" },
        { name: "Langouste europ√©enne", bg: "VIDE", cond: "VIDE" },
        { name: "Loche des fleurs", bg: "VIDE", cond: "VIDE" },
        { name: "Loche des rochers", bg: "VIDE", cond: "VIDE" },
        { name: "Lotte", bg: "VIDE", cond: "VIDE" },
        { name: "Maquereau atlantique", bg: "VIDE", cond: "VIDE" },
        { name: "Moule", bg: "VIDE", cond: "VIDE" },
        { name: "Omble", bg: "VIDE", cond: "VIDE" },
        { name: "Omble chevalier", bg: "VIDE", cond: "VIDE" },
        { name: "Ombrine", bg: "VIDE", cond: "VIDE" },
        { name: "Oranda", bg: "VIDE", cond: "VIDE" },
        { name: "Pagellus bogaraveo", bg: "VIDE", cond: "VIDE" },
        { name: "Perche de mer", bg: "VIDE", cond: "VIDE" },
        { name: "Perche de prunier", bg: "VIDE", cond: "VIDE" },
        { name: "Perche de rivi√®re", bg: "VIDE", cond: "VIDE" },
        { name: "Pieuvre", bg: "VIDE", cond: "VIDE" },
        { name: "Pieuvre naine atlantique", bg: "VIDE", cond: "VIDE" },
        { name: "POISSON-TIGRE", bg: "VIDE", cond: "VIDE" },
        { name: "Plie europ√©enne", bg: "VIDE", cond: "VIDE" },
        { name: "Poisson agrion", bg: "VIDE", cond: "VIDE" },
        { name: "Poisson-clown", bg: "VIDE", cond: "VIDE" },
        { name: "Poisson combattant", bg: "VIDE", cond: "VIDE" },
        { name: "Poisson divin", bg: "VIDE", cond: "VIDE" },
        { name: "Poisson √©pineux", bg: "VIDE", cond: "VIDE" },
        { name: "Poisson-globe", bg: "VIDE", cond: "VIDE" },
        { name: "Poisson-lion", bg: "VIDE", cond: "VIDE" },
        { name: "Poisson lune", bg: "VIDE", cond: "VIDE" },
        { name: "Poisson rouge", bg: "VIDE", cond: "VIDE" },
        { name: "Poisson ruban", bg: "VIDE", cond: "VIDE" },
        { name: "Poisson suspendu", bg: "VIDE", cond: "VIDE" },
        { name: "Poisson √† yeux rouges", bg: "VIDE", cond: "VIDE" },
        { name: "R√©galec", bg: "VIDE", cond: "VIDE" },
        { name: "Requin baleine", bg: "VIDE", cond: "VIDE" },
        { name: "Requin mako", bg: "VIDE", cond: "VIDE" },
        { name: "Requin marteau", bg: "VIDE", cond: "VIDE" },
        { name: "Rouget barbet", bg: "VIDE", cond: "VIDE" },
        { name: "Roussette", bg: "VIDE", cond: "VIDE" },
        { name: "Sandre blanc", bg: "VIDE", cond: "VIDE" },
        { name: "Saumon atlantique", bg: "VIDE", cond: "VIDE" },
        { name: "Saumon k√©ta", bg: "VIDE", cond: "VIDE" },
        { name: "Saurel", bg: "VIDE", cond: "VIDE" },
        { name: "Sardine", bg: "VIDE", cond: "VIDE" },
        { name: "Seiche europ√©enne", bg: "VIDE", cond: "VIDE" },
        { name: "Silure europ√©en", bg: "VIDE", cond: "VIDE" },
        { name: "Tanche dor√©e", bg: "VIDE", cond: "VIDE" },
        { name: "T√™tard", bg: "VIDE", cond: "VIDE" },
        { name: "Thon rouge", bg: "VIDE", cond: "VIDE" },
        { name: "Tilapia", bg: "VIDE", cond: "VIDE" },
        { name: "Tortue verte", bg: "VIDE", cond: "VIDE" },
        { name: "Turbot", bg: "VIDE", cond: "VIDE" },
        { name: "Vairon", bg: "VIDE", cond: "VIDE" },
        { name: "Zingel streber", bg: "VIDE", cond: "VIDE" }
    ];

    // --- INTERFACE ---
    var customControl = L.control({position: 'topleft'});
    customControl.onAdd = function() {
        var div = L.DomUtil.create('div', 'leaflet-control-layers');
        L.DomEvent.disableClickPropagation(div);
        L.DomEvent.disableScrollPropagation(div);
        div.innerHTML = `
            <div id="c-pnj"><div class="accordion-title title-pnj">PNJ</div><div class="accordion-content"></div></div>
            <div id="c-bus"><div class="accordion-title title-bus">BUS</div><div class="accordion-content"></div></div>
            <div id="c-shop"><div class="accordion-title title-shop">MAGASINS</div><div class="accordion-content"></div></div>
            <div id="c-lieux"><div class="accordion-title title-lieux">LIEUX</div><div class="accordion-content"></div></div>
            <div id="c-fish"><div class="accordion-title title-poisson">POISSONS</div><div class="accordion-content"></div></div>`;
        return div;
    };
    customControl.addTo(map);

    function initMenu() {
        ['pnj','bus','shop','lieux'].forEach(cat => {
            var box = document.getElementById('c-'+cat), content = box.querySelector('.accordion-content'), title = box.querySelector('.accordion-title');
            dataStorage[cat].forEach(item => {
                var el = document.createElement('div'); el.className = 'menu-item';
                el.innerHTML = (item.img ? `<img src="${item.img}" class="menu-icon">` : '') + item.name;
                el.onclick = () => { 
                    if(!item.startOn) { if(currentActiveLayer) map.removeLayer(currentActiveLayer); item.layer.addTo(map); currentActiveLayer = item.layer; } 
                    map.flyTo(item.pos, 2); 
                };
                content.appendChild(el);
            });
            title.onclick = () => content.classList.toggle('active');
        });
        var fCont = document.querySelector('#c-fish .accordion-content'), fTit = document.querySelector('#c-fish .accordion-title');
        fishList.forEach(f => {
            var el = document.createElement('div'); el.className = 'menu-item'; el.innerHTML = f.name;
            el.onclick = () => { 
                if(f.bg !== "VIDE") {
                    document.getElementById('fish-main').src = f.bg; 
                    document.getElementById('fish-cond').src = (f.cond !== "VIDE") ? f.cond : ""; 
                    document.getElementById('overlay-fish').style.display = 'flex'; 
                } else { alert("Donn√©es bient√¥t disponibles"); }
            };
            fCont.appendChild(el);
        });
        fTit.onclick = () => fCont.classList.toggle('active');
    }
    setTimeout(initMenu, 300);
</script>
</body>
</html>
