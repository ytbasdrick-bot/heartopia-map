<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Maptopia FR - Rex Edition</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        /* --- BASE & FOND --- */
        body { 
            margin: 0; 
            padding: 0; 
            background: url('Heartopia.jpg') no-repeat center center fixed; 
            background-size: cover;
            overflow: hidden; 
            font-family: 'Segoe UI', Roboto, sans-serif; 
        }

        /* --- √âCRAN D'ACCUEIL --- */
        #intro-screen { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: black; z-index: 20000; display: flex; align-items: flex-end; justify-content: center; transition: opacity 1s ease; }
        .video-bg-blur { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; filter: blur(20px) brightness(0.4); }
        #intro-video { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: contain; z-index: 2; border-left: 2px solid #d4af37; border-right: 2px solid #d4af37; }
        
        .welcome-box { position: relative; bottom: 8%; width: 500px; padding: 30px; background: rgba(0, 0, 0, 0.85); border: 2px solid #d4af37; border-radius: 20px; color: white; z-index: 10; backdrop-filter: blur(10px); text-align: center; }
        .welcome-box h1 { margin: 0; font-size: 30px; letter-spacing: 3px; color: #fff; text-transform: uppercase; }
        .welcome-subtitle { color: #d4af37; font-size: 18px; margin: 15px 0 5px 0; display: block; font-weight: bold; }
        .tip-text { display: block; font-size: 13px; color: #ccc; margin-bottom: 20px; font-style: italic; }
        
        #enter-button { padding: 15px 45px; background: linear-gradient(135deg, #8b0000, #d4af37); color: white; border: 1px solid white; border-radius: 50px; font-size: 18px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        #enter-button:hover { transform: scale(1.05); box-shadow: 0 0 15px #d4af37; }

        /* --- ADAPTATION MOBILE (Bouton Entr√©e) --- */
        @media (max-width: 768px) {
            .welcome-box { width: 85%; bottom: 12%; padding: 20px; }
            .welcome-box h1 { font-size: 24px; }
            #enter-button { width: 100%; padding: 20px 0; font-size: 20px; border-radius: 15px; }
        }

        /* --- CARTE --- */
        #map { height: 100vh; width: 100vw; opacity: 0; transition: opacity 2s ease; background: transparent !important; }

        /* --- MENU GAUCHE --- */
        .leaflet-control-layers { left: 20px !important; top: 20px !important; width: 260px !important; background: rgba(255, 255, 255, 0.98) !important; border-radius: 15px !important; padding: 10px !important; max-height: 80vh; overflow-y: auto !important; border: none !important; box-shadow: 0 4px 15px rgba(0,0,0,0.3) !important; }
        .accordion-title { color: white; padding: 10px; border-radius: 8px; cursor: pointer; font-weight: bold; margin-bottom: 5px; text-align: center; font-size: 12px; text-transform: uppercase; }
        .title-pnj { background: #8b0000; } 
        .title-bus { background: #2980b9; } 
        .title-shop { background: #9b59b6; } 
        .title-lieux { background: #27ae60; } 
        .title-poisson { background: #f39c12; }
        .accordion-content { display: none; margin-bottom: 10px; } 
        .accordion-content.active { display: block; }
        .menu-item { display: flex; align-items: center; padding: 8px; cursor: pointer; font-size: 13px; border-bottom: 1px solid #eee; color: #333; }

        /* --- SYST√àME POISSON --- */
        #overlay-fish { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 30000; display: none; align-items: center; justify-content: center; }
        .fish-card { display: flex; flex-direction: column; align-items: center; background: white; padding: 25px; border-radius: 20px; border: 3px solid #d4af37; width: 550px; max-width: 95%; }
        .fish-img-container { width: 100%; background: white; text-align: center; }
        .fish-img-container img { width: 100%; height: auto; display: block; mix-blend-mode: multiply; margin: 0 auto; }
        #fish-name { margin: 0 0 15px 0; color: #333; font-size: 26px; text-transform: uppercase; font-weight: 800; }

        /* --- FOOTER & DISCORD --- */
        .footer-wiki { position: fixed; bottom: 0; left: 0; width: 100%; height: 75px; z-index: 3000; background: linear-gradient(90deg, #8b0000, #d4af37, #8b0000); display: flex; align-items: center; justify-content: center; border-top: 3px solid white; }
        .footer-wiki a { color: white; text-decoration: none; font-weight: 900; font-size: 24px; letter-spacing: 2px; text-transform: uppercase; }
        
        .discord-btn { position: fixed; bottom: 95px; right: 25px; z-index: 3001; transition: transform 0.3s; }
        .discord-btn img { width: 70px; height: 70px; filter: drop-shadow(0 0 15px rgba(114, 137, 218, 0.8)); }

        /* --- NOTES & L√âGENDE --- */
        .ping-legend { position: fixed; right: 20px; top: 20px; width: 220px; background: rgba(0,0,0,0.9); border: 2px solid #d4af37; border-radius: 15px; padding: 15px; color: white; z-index: 1000; max-height: 40vh; overflow-y: auto; }
        .label-ville { background: white !important; border: 2px solid #3498db !important; border-radius: 5px; padding: 2px 8px; font-weight: bold; font-size: 11px; color: #2980b9; }
        .label-eau { background: rgba(41, 128, 185, 0.3) !important; border: 1px solid #2980b9 !important; border-radius: 5px; padding: 2px 8px; font-size: 10px; color: white; font-weight: bold; }
        
        .team-box { position: fixed; bottom: 95px; left: 20px; z-index: 3000; text-align: center; }
        .team-text { font-weight: 900; font-size: 18px; color: white; text-shadow: 0 0 10px #d4af37; margin-bottom: 5px; display: block; }
        .team-img { width: 85px; height: 85px; border-radius: 15px; border: 2px solid #d4af37; cursor: pointer; }
    </style>
</head>
<body>

<audio id="main-audio"><source src="sonheartopia.mp4" type="audio/mp4"></audio>

<div id="intro-screen">
    <video class="video-bg-blur" autoplay muted loop playsinline><source src="pere noel.mp4" type="video/mp4"></video>
    <video id="intro-video" autoplay muted loop playsinline><source src="pere noel.mp4" type="video/mp4"></video>
    <div class="welcome-box">
        <h1>MAPTOPIA FR</h1>
        <span class="welcome-subtitle">L'outil ultime pour Heartopia.</span>
        <span class="tip-text">üí° Astuce : Fais un clic droit sur la carte pour ajouter tes propres marqueurs !</span>
        <button id="enter-button" onclick="startExperience()">üéÑ ENTRER üéÑ</button>
    </div>
</div>

<div id="map"></div>

<a href="https://discord.gg/Ysc7KBy6R4" target="_blank" class="discord-btn">
    <img src="Discord-Logo-PNG-Pic.png" alt="Discord">
</a>

<div class="ping-legend">
    <h3 style="text-align:center; color:#d4af37; font-size:14px; margin-top:0;">üìå MES NOTES</h3>
    <div id="legend-list"></div>
</div>

<div class="team-box">
    <span class="team-text">TEAM HEART FR</span>
    <img src="groupefr.png" class="team-img" onclick="document.getElementById('overlay-team').style.display='flex'">
</div>

<div id="overlay-team" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:40000; display:none; align-items:center; justify-content:center;" onclick="this.style.display='none'">
    <img src="groupefr.png" style="max-width:80%; border:4px solid #d4af37; border-radius:20px;">
</div>

<div id="overlay-fish" onclick="this.style.display='none'">
    <div class="fish-card" onclick="event.stopPropagation()">
        <h2 id="fish-name"></h2>
        <div class="fish-img-container">
            <img id="fish-main">
            <img id="fish-cond">
        </div>
        <button onclick="document.getElementById('overlay-fish').style.display='none'" style="margin-top:20px; padding:12px 40px; cursor:pointer; background:#8b0000; color:white; border:1px solid #d4af37; border-radius:8px; font-weight:bold; font-size: 16px;">FERMER</button>
    </div>
</div>

<div class="footer-wiki"><a href="https://jayibwi.wixsite.com/my-site-1" target="_blank">üìñ WIKI FR COMPLET üìñ</a></div>

<script>
    function startExperience() {
        document.getElementById('main-audio').play().catch(e => {});
        document.getElementById('intro-screen').style.opacity = '0';
        document.getElementById('map').style.opacity = '1';
        setTimeout(() => { document.getElementById('intro-screen').style.display = 'none'; }, 1000);
    }

    var bounds = [[-1000, 0], [0, 1000]];
    var map = L.map('map', { 
        crs: L.CRS.Simple, 
        minZoom: 0, 
        maxZoom: 3, 
        zoom: 1, 
        maxBounds: L.latLngBounds(bounds).pad(0.5), 
        maxBoundsViscosity: 0.8 
    });
    L.imageOverlay('carte.png', bounds).addTo(map);
    map.setView([-500, 500], 1);

    var busLayer = L.layerGroup();
    var pnjLayer = L.layerGroup();

    function updateMarkerSizes() {
        var z = map.getZoom();
        var busSize = 45 + (z * 25);
        var pnjSize = 45 + (z * 20);
        busLayer.eachLayer(l => { if(l instanceof L.Marker) l.setIcon(L.icon({ iconUrl: 'bus.png', iconSize: [busSize, busSize], iconAnchor: [busSize/2, busSize] })); });
        pnjLayer.eachLayer(l => { if(l instanceof L.Marker && l.options.customImg) l.setIcon(L.icon({ iconUrl: l.options.customImg, iconSize: [pnjSize, pnjSize], iconAnchor: [pnjSize/2, pnjSize] })); });
    }
    map.on('zoomend', updateMarkerSizes);

    var userPings = JSON.parse(localStorage.getItem('maptopia_pings')) || [];
    var pingMarkers = {};
    const colors = { blue: '#3498db', red: '#e74c3c', green: '#2ecc71', yellow: '#f1c40f', purple: '#9b59b6' };

    function updateLegend() {
        const list = document.getElementById('legend-list'); list.innerHTML = "";
        userPings.forEach(p => {
            const item = document.createElement('div'); item.style.cursor="pointer";
            item.innerHTML = `<span style="color:${colors[p.color]||'blue'}">‚óè</span> <span>${p.text}</span>`;
            item.onclick = () => map.flyTo(p.latlng, 2);
            list.appendChild(item);
        });
    }

    function createPing(latlng, text, color, isNew, id) {
        var mid = id || "id_" + Date.now();
        var myIcon = L.divIcon({ className:'c-icon', html:`<div style="background:${colors[color]||'blue'};width:12px;height:12px;border:2px solid #fff;border-radius:50%"></div>`, iconSize:[12,12] });
        var marker = L.marker(latlng, {icon: myIcon}).addTo(map);
        pingMarkers[mid] = marker;
        var div = document.createElement('div');
        if (isNew) {
            div.innerHTML = `<input type="text" id="in-${mid}" placeholder="Note..." style="width:120px;"><button onclick="confirmPing('${mid}',${latlng.lat},${latlng.lng})" style="display:block;width:100%;margin-top:5px;background:#27ae60;color:white;border:none;border-radius:3px;cursor:pointer;">OK</button>`;
        } else {
            div.innerHTML = `<b>Note:</b><br>${text}<br><button onclick="removePing('${mid}')" style="background:#e74c3c;color:white;border:none;width:100%;margin-top:5px;border-radius:3px;cursor:pointer;">Supprimer</button>`;
        }
        marker.bindPopup(div); if(isNew) marker.openPopup();
    }

    window.confirmPing = function(id, lat, lng) {
        var v = document.getElementById('in-'+id).value;
        if(v){ userPings.push({id:id, latlng:{lat,lng}, text:v, color:'blue'}); localStorage.setItem('maptopia_pings', JSON.stringify(userPings)); map.removeLayer(pingMarkers[id]); createPing({lat,lng}, v, 'blue', false, id); updateLegend(); }
    };

    window.removePing = function(id) {
        if(pingMarkers[id]) map.removeLayer(pingMarkers[id]);
        userPings = userPings.filter(p => String(p.id) !== String(id));
        localStorage.setItem('maptopia_pings', JSON.stringify(userPings)); updateLegend();
    };

    map.on('contextmenu', (e) => createPing(e.latlng, "", "blue", true));
    userPings.forEach(p => createPing(p.latlng, p.text, p.color, false, p.id));
    updateLegend();

    var dataStorage = { pnj:[], bus:[], shop:[], lieux:[] };
    var currentActiveLayer = null;

    function register(cat, pos, name, img, opts = {}) {
        let g = (cat === 'bus') ? busLayer : (cat === 'pnj' ? pnjLayer : L.layerGroup());
        if(opts.type) { L.marker(pos, {opacity:0}).addTo(g).bindTooltip(name, {permanent:true, direction:'center', className:opts.type}); } 
        else { var s = (cat === 'shop') ? 60 : 70; L.marker(pos, {icon: L.icon({iconUrl:img, iconSize:[s,s], iconAnchor:[s/2,s]}), customImg: img}).addTo(g).bindPopup(name); }
        if(opts.startOn) g.addTo(map);
        dataStorage[cat].push({name:name, pos:pos, layer:g, img:img, startOn: opts.startOn});
    }

    // DONN√âES
    [ ["Bob",[-471,501],'pnj/bob.png'], ["Atara",[-526,499],'pnj/atara.png'], ["Collectionneur",[-478,493],'pnj/collectioneur.png'], ["Doroth√©e",[-469,488],'pnj/doroth√©e.png'], ["Massimo",[-446,493],'pnj/massimo.png'], ["Andrew",[-399,591],'pnj/andrew.png'], ["Eric",[-259,522],'pnj/eric.png'], ["Vanya",[-456,549],'pnj/vanya.png'], ["Naniwa",[-502,582],'pnj/niniwa.png'], ["Joan",[-502,519],'pnj/joa.png'], ["Will",[-807,419],'pnj/will.png'], ["Patti",[-355,809],'pnj/patti.png'], ["Vernie",[-653,225],'pnj/vernie.png'], ["Bayley",[-498,526],'pnj/bayley.png'] ].forEach(p => register('pnj', p[1], p[0], p[2]));
    [ ["Banlieue Ouest",[-533,340]], ["Banlieue Village",[-519,639]], ["Village P√™cheurs",[-654,479]], ["Champ Fleurs",[-532,218]], ["Montagne Thermale",[-222,512]], ["Banlieue Nord",[-373,480]], ["Place Centrale",[-497,481]], ["For√™t",[-500,798]] ].forEach(b => register('bus', b[1], b[0], 'bus.png'));
    
    var lieux = [
        {pos:[-538,492], name:"Place Centrale", type:"label-ville", startOn:true}, {pos:[-692,506], name:"Village P√™cheurs", type:"label-ville", startOn:true}, {pos:[-438,513], name:"Village", type:"label-ville", startOn:true}, {pos:[-649,185], name:"Champ Fleurs", type:"label-ville", startOn:true}, {pos:[-440,184], name:"Montagne Baleine", type:"label-ville", startOn:true}, {pos:[-184,291], name:"Ruines", type:"label-ville", startOn:true}, {pos:[-223,501], name:"Montagne Thermale", type:"label-ville", startOn:true}, {pos:[-228,627], name:"Falaise Rocheuse", type:"label-ville", startOn:true}, {pos:[-531,805], name:"For√™t Ch√™nes", type:"label-ville", startOn:true}, {pos:[-494,429], name:"Rue des Arts", type:"label-ville", startOn:true}, {pos:[-510,558], name:"Rue du Jardin", type:"label-ville", startOn:true}, {pos:[-736,602], name:"Quai Oriental", type:"label-ville", startOn:true}, {pos:[-690,402], name:"Quai", type:"label-ville", startOn:true}, {pos:[-780,387], name:"Phare", type:"label-ville", startOn:true}, {pos:[-691,783], name:"Tremplin", type:"label-ville", startOn:true}, {pos:[-338,933], name:"√éle For√™t", type:"label-ville", startOn:true}, {pos:[-587,406], name:"Banlieue", type:"label-ville", startOn:true}, {pos:[-725,208], name:"Plage Violette", type:"label-ville", startOn:true}, {pos:[-783,478], name:"Mer Calme", type:"label-eau", startOn:true}, {pos:[-534,92], name:"Mer de Baleine", type:"label-eau", startOn:true}, {pos:[-68,497], name:"Ancienne Mer", type:"label-eau", startOn:true}, {pos:[-536,232], name:"Lac Prairie", type:"label-eau", startOn:true}, {pos:[-337,319], name:"Rivi√®re Aurore", type:"label-eau", startOn:true}, {pos:[-176,394], name:"Lac Volcanique", type:"label-eau", startOn:true}, {pos:[-265,537], name:"Lac Thermale", type:"label-eau", startOn:true}, {pos:[-344,652], name:"Rivi√®re Peu Profonde", type:"label-eau", startOn:true}, {pos:[-598,748], name:"Lac For√™t", type:"label-eau", startOn:true}, {pos:[-431,774], name:"Lac For√™t Haut", type:"label-eau", startOn:true}, {pos:[-608,481], name:"Lac Banlieue", type:"label-eau", startOn:true}, {pos:[-669,368], name:"Rivi√®re Calme", type:"label-eau", startOn:true}, {pos:[-674,627], name:"Fleuve G√©ant", type:"label-eau", startOn:true},
        {pos:[-472,487], name:"V√™tements", icon:'vetement.png', isShop:true}, {pos:[-474,503], name:"Meubles", icon:'Meuble.png', isShop:true}, {pos:[-496,523], name:"Animaux", icon:'chien.png', isShop:true}, {pos:[-440,467], name:"Librairie", icon:'Librairie.png', isShop:true}
    ];
    lieux.forEach(l => register(l.isShop ? 'shop' : 'lieux', l.pos, l.name, l.icon || '', {type: l.type, startOn: l.startOn}));

    const fishList = [ 
        { name: "Ablette", bg: "poisson/ablette1.png", cond: "poisson/Lacs.png" }, { name: "Acantharchus pomotis", bg: "poisson/Acantharchus_pomotis1.png", cond: "poisson/arcantharcus%20pomotis.png" }, { name: "Aphyosemion striatum", bg: "poisson/Aphyosemion%20striatum.png", cond: "poisson/Aphyosemion%20striatum1.png" }, { name: "Barbeau", bg: "poisson/barbeau1.png", cond: "poisson/barbeau.png" }, { name: "Barbillon", bg: "poisson/barbillon1.png", cond: "poisson/barbillon.png" }, { name: "Baudroie", bg: "poisson/baudroie1.png", cond: "poisson/Baudroie.png" }, { name: "Bernard l'Hermite", bg: "VIDE", cond: "poisson/bernardlhermite.png" }, { name: "Blennie de rivi√®re", bg: "VIDE", cond: "poisson/bleniiedesrivieree.png" }, { name: "Bonite", bg: "poisson/bonite1.png", cond: "poisson/bonite.png" }, { name: "Carpe argent√©e", bg: "poisson/carpe_argentee1.png", cond: "poisson/carpe_argentee.png" }, { name: "Carpe europ√©enne", bg: "poisson/Carpe_europeenne1.png", cond: "poisson/Carpe_europeenne.png" }, { name: "Carpe Papillon", bg: "poisson/carpe%20papillon1.png", cond: "poisson/carpe%20papillon.png" }, { name: "Carpe noire", bg: "poisson/carpe%20noir.png", cond: "poisson/carpe%20noir1.png" }, { name: "Chabot", bg: "VIDE", cond: "poisson/chabot.png" }, { name: "Chim√®re argent√©e", bg: "poisson/chimere%20argent1.pnj.avif", cond: "poisson/chimere%20argent%C3%A9.png" }, { name: "Com√®te coussut", bg: "poisson/comete_coussut1.png", cond: "poisson/comete_coussut.png" }, { name: "Crabe de ruisseau", bg: "poisson/Crabe_de_ruisseau1.png", cond: "poisson/crabe%20de%20ruisseau.png" }, { name: "Crevette verte", bg: "poisson/crevette_verte1.png", cond: "poisson/crevette%20verte.png" }, { name: "Cuvier", bg: "poisson/cuvier1.png", cond: "poisson/cuvier.png" }, { name: "Cyber-Poisson", bg: "poisson/Cyber-Poisson1.png", cond: "poisson/Cyber-Poisson.png" }, { name: "Cyprin dor√©", bg: "poisson/cyprin_dore1.png", cond: "poisson/cyprin_dore.png" }, { name: "Dario dario", bg: "poisson/dario_dario1.png", cond: "poisson/dario_dario.png" }, { name: "Dasyatis", bg: "poisson/dasyatis1.png", cond: "poisson/Dasyatis.png" }, { name: "Diodon", bg: "poisson/Diodon1.png", cond: "poisson/Diodon.png" }, { name: "Discus", bg: "poisson/discus1.png", cond: "poisson/discus.png" }, { name: "Dolly Varden", bg: "poisson/Dolly_Varden1.png", cond: "poisson/dolly%20varden.png" }, { name: "Dorade grise", bg: "poisson/dorade_grise1.png", cond: "poisson/dorade_grise.png" }, { name: "Ecrevisse", bg: "poisson/ecrevisse1.png", cond: "poisson/ecrevisse.png" }, { name: "Eperlan", bg: "poisson/eperlan1.png", cond: "poisson/eperlan.png" }, { name: "Esturgeon", bg: "poisson/esturgeon1.png", cond: "poisson/esturgeon.png" }, { name: "Gardon", bg: "poisson/gardon1.png", cond: "poisson/Gardon.png" }, { name: "Gobiidae", bg: "poisson/Gobiidae1.png", cond: "poisson/Gobiidae.png" }, { name: "Grand Blanc", bg: "poisson/grand_blanc1.png", cond: "poisson/grand_blanc.png" }, { name: "Grenouille", bg: "poisson/grenouille1.png", cond: "poisson/grenouille.png" }, { name: "Guitare de mer", bg: "poisson/guitare_de_mer1.png", cond: "poisson/guitare_de_mer.png" }, { name: "Guppy", bg: "poisson/guppy1.png", cond: "poisson/guppy.png" }, { name: "Hareng", bg: "poisson/hareng1.png", cond: "poisson/hareng.png" }, { name: "Hippocampe", bg: "poisson/hippocampe1.png", cond: "poisson/Hippocampe.png" }, { name: "Kijiki", bg: "poisson/kijiki1.png", cond: "poisson/Kijiki.png" }, { name: "Koi", bg: "poisson/koi1.png", cond: "poisson/koi.png" }, { name: "Lanceur", bg: "poisson/lanceur1.png", cond: "poisson/lanceur.png" }, { name: "Lievre de mer", bg: "poisson/lievre_de_mer1.png", cond: "poisson/lievre_de_mer.png" }, { name: "Limande", bg: "poisson/limande1.png", cond: "poisson/limande.png" }, { name: "Loche", bg: "poisson/loche1.png", cond: "poisson/loche.png" }, { name: "Loup", bg: "poisson/loup1.png", cond: "poisson/loup.png" }, { name: "Lune de mer", bg: "poisson/lune_de_mer1.png", cond: "poisson/lune_de_mer.png" }, { name: "Macropode", bg: "poisson/macropode1.png", cond: "poisson/macropode.png" }, { name: "Main de mer", bg: "poisson/main_de_mer1.png", cond: "poisson/main_de_mer.png" }, { name: "Makaire bleu", bg: "poisson/makaire_bleu1.png", cond: "poisson/makaire_bleu.png" }, { name: "Makaire noir", bg: "poisson/makaire_noir1.png", cond: "poisson/makaire_noir.png" }, { name: "Maquereau", bg: "poisson/maquereau1.png", cond: "poisson/maquereau.png" }, { name: "Meduse", bg: "poisson/meduse1.png", cond: "poisson/Meduse.png" }, { name: "Merlan", bg: "poisson/merlan1.png", cond: "poisson/merlan.png" }, { name: "Muge", bg: "poisson/muge1.png", cond: "poisson/Muge.png" }, { name: "Mur√®ne", bg: "poisson/murene1.png", cond: "poisson/Murene.png" }, { name: "Nase", bg: "poisson/nase1.png", cond: "poisson/Nase.png" }, { name: "Neon", bg: "poisson/neon1.png", cond: "poisson/neon.png" }, { name: "Ombre", bg: "poisson/ombre1.png", cond: "poisson/ombre.png" }, { name: "Omis", bg: "poisson/omis1.png", cond: "poisson/Omis.png" }, { name: "Oranda", bg: "poisson/oranda1.png", cond: "poisson/oranda.png" }, { name: "Oscars", bg: "poisson/oscars1.png", cond: "poisson/oscars.png" }, { name: "Pagre", bg: "poisson/pagre1.png", cond: "poisson/Pagre.png" }, { name: "Palourde", bg: "poisson/palourde1.png", cond: "poisson/Palourde.png" }, { name: "Panga", bg: "poisson/panga1.png", cond: "poisson/Panga.png" }, { name: "Papillon", bg: "poisson/papillon1.png", cond: "poisson/Papillon.png" }, { name: "Perche", bg: "poisson/perche1.png", cond: "poisson/perche.png" }, { name: "Pholade", bg: "poisson/pholade1.png", cond: "poisson/pholade.png" }, { name: "Piraya", bg: "poisson/piraya1.png", cond: "poisson/Piraya.png" }, { name: "Poisson-Ange", bg: "poisson/Poisson-Ange1.png", cond: "poisson/Poisson-Ange.png" }, { name: "Poisson-Balle", bg: "poisson/Poisson-Balle1.png", cond: "poisson/Poisson-Balle.png" }, { name: "Poisson-Chat", bg: "poisson/Poisson-Chat1.png", cond: "poisson/Poisson-Chat.png" }, { name: "Poisson-Chirurgien", bg: "poisson/Poisson-Chirurgien1.png", cond: "poisson/Poisson-Chirurgien.png" }, { name: "Poisson-Clown", bg: "poisson/Poisson-Clown1.png", cond: "poisson/Poisson-Clown.png" }, { name: "Poisson-Combattant", bg: "poisson/Poisson-Combattant1.png", cond: "poisson/Poisson-Combattant.png" }, { name: "Poisson-Couteau", bg: "poisson/Poisson-Couteau1.png", cond: "poisson/Poisson-Couteau.png" }, { name: "Poisson-Dragon", bg: "poisson/Poisson-Dragon1.png", cond: "poisson/Poisson-Dragon.png" }, { name: "Poisson-Globe", bg: "poisson/Poisson-Globe1.png", cond: "poisson/Poisson-Globe.png" }, { name: "Poisson-Hache", bg: "poisson/Poisson-Hache1.png", cond: "poisson/Poisson-Hache.png" }, { name: "Poisson-Lion", bg: "poisson/Poisson-Lion1.png", cond: "poisson/Poisson-Lion.png" }, { name: "Poisson-Lune", bg: "poisson/Poisson-Lune1.png", cond: "poisson/Poisson-Lune.png" }, { name: "Poisson-Mandarin", bg: "poisson/Poisson-Mandarin1.png", cond: "poisson/Poisson-Mandarin.png" }, { name: "Poisson-Perroquet", bg: "poisson/Poisson-Perroquet1.png", cond: "poisson/Poisson-Perroquet.png" }, { name: "Poisson-Pilote", bg: "poisson/Poisson-Pilote1.png", cond: "poisson/Poisson-Pilote.png" }, { name: "Poisson-Ruban", bg: "poisson/Poisson-Ruban1.png", cond: "poisson/Poisson-Ruban.png" }, { name: "Poisson-Scorpion", bg: "poisson/Poisson-Scorpion1.png", cond: "poisson/Poisson-Scorpion.png" }, { name: "Poisson-Tigre", bg: "poisson/Poisson-Tigre1.png", cond: "poisson/Poisson-Tigre.png" }, { name: "Poisson-Volant", bg: "poisson/Poisson-Volant1.png", cond: "poisson/Poisson-Volant.png" }, { name: "Poulpe", bg: "poisson/Poulpe1.png", cond: "poisson/Poulpe.png" }, { name: "Raie", bg: "poisson/Raie1.png", cond: "poisson/Raie.png" }, { name: "Rascasse", bg: "poisson/Rascasse1.png", cond: "poisson/Rascasse.png" }, { name: "Requin-Baleine", bg: "poisson/Requin-Baleine1.png", cond: "poisson/Requin-Baleine.png" }, { name: "Requin-Marteau", bg: "poisson/Requin-Marteau1.png", cond: "poisson/Requin-Marteau.png" }, { name: "Sardine", bg: "poisson/Sardine1.png", cond: "poisson/Sardine.png" }, { name: "Saumon", bg: "poisson/Saumon1.png", cond: "poisson/Saumon.png" }, { name: "Sole", bg: "poisson/Sole1.png", cond: "poisson/Sole.png" }, { name: "Tanche", bg: "poisson/Tanche1.png", cond: "poisson/Tanche.png" }, { name: "Thon", bg: "poisson/Thon1.png", cond: "poisson/Thon.png" }, { name: "Truite", bg: "poisson/Truite1.png", cond: "poisson/Truite.png" } 
    ];

    var menuCtrl = L.control({position: 'topleft'});
    menuCtrl.onAdd = function() {
        var div = L.DomUtil.create('div', 'leaflet-control-layers');
        L.DomEvent.disableClickPropagation(div);
        L.DomEvent.disableScrollPropagation(div);
        div.innerHTML = `
            <div id="c-pnj"><div class="accordion-title title-pnj">PNJ (14)</div><div class="accordion-content"></div></div>
            <div id="c-bus"><div class="accordion-title title-bus">BUS (8)</div><div class="accordion-content"></div></div>
            <div id="c-shop"><div class="accordion-title title-shop">MAGASINS (4)</div><div class="accordion-content"></div></div>
            <div id="c-lieux"><div class="accordion-title title-lieux">LIEUX (31)</div><div class="accordion-content"></div></div>
            <div id="c-fish"><div class="accordion-title title-poisson">POISSONS (${fishList.length})</div><div class="accordion-content"></div></div>`;
        return div;
    };
    menuCtrl.addTo(map);

    function initMenu() {
        ['pnj','bus','shop','lieux'].forEach(cat => {
            var box = document.getElementById('c-'+cat), content = box.querySelector('.accordion-content');
            dataStorage[cat].forEach(item => {
                var el = document.createElement('div'); el.className = 'menu-item';
                el.innerHTML = (item.img ? `<img src="${item.img}" style="width:24px;margin-right:8px;">` : '') + item.name;
                el.onclick = () => { if(!item.startOn){ if(currentActiveLayer) map.removeLayer(currentActiveLayer); item.layer.addTo(map); currentActiveLayer = item.layer; } map.flyTo(item.pos, 2); };
                content.appendChild(el);
            });
            box.querySelector('.accordion-title').onclick = () => content.classList.toggle('active');
        });
        var fCont = document.querySelector('#c-fish .accordion-content');
        fishList.forEach(f => {
            var el = document.createElement('div'); el.className = 'menu-item'; el.innerText = f.name;
            el.onclick = () => { 
                document.getElementById('fish-name').innerText = f.name; 
                document.getElementById('fish-main').src = f.bg; 
                document.getElementById('fish-cond').src = (f.cond !== "VIDE") ? f.cond : ""; 
                document.getElementById('overlay-fish').style.display = 'flex'; 
            };
            fCont.appendChild(el);
        });
        document.querySelector('#c-fish .accordion-title').onclick = () => fCont.classList.toggle('active');
    }
    setTimeout(initMenu, 300);
</script>
</body>
</html>
