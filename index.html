<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Carte Interactive Heartopia FR - No√´l</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body { margin: 0; padding: 0; background: #0b1021; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
        #intro-screen { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: black; z-index: 20000; display: flex; align-items: flex-end; justify-content: center; transition: opacity 1s ease; }
        #intro-video { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: contain; background: black; z-index: 1; }
        .welcome-box { position: relative; bottom: 50px; width: 600px; padding: 25px; background: rgba(0, 0, 0, 0.7); border: 2px solid #d4af37; border-radius: 20px; color: white; z-index: 10; backdrop-filter: blur(8px); text-align: center; box-shadow: 0 0 30px rgba(0,0,0,0.8); }
        #enter-button { padding: 12px 35px; background: linear-gradient(135deg, #8b0000, #d4af37); color: white; border: 1px solid white; border-radius: 50px; font-size: 17px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .snowflake { position: fixed; top: -10%; z-index: 21000; color: white; user-select: none; pointer-events: none; animation: fall linear infinite; }
        @keyframes fall { to { transform: translateY(110vh) rotate(360deg); } }
        #map { height: 100vh; width: 100vw; background: transparent !important; opacity: 0; transition: opacity 2s ease; }
        .leaflet-control-layers { position: fixed !important; left: 30px !important; top: 30px !important; width: 280px !important; background: rgba(255, 255, 255, 0.95) !important; border-radius: 15px !important; padding: 10px !important; max-height: 80vh; overflow-y: auto; z-index: 1000; border: none !important; }
        .leaflet-control-layers-list { display: none !important; }
        .accordion-title { color: white; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold; margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center; font-size: 13px; margin-top: 5px; }
        .title-pnj { background: #8b0000; }
        .title-bus { background: #2980b9; }
        .title-poisson { background: #f39c12; }
        .accordion-content { display: none; padding-left: 5px; border-left: 4px solid #ccc; background: white; margin-bottom: 10px; }
        .accordion-content.active { display: block; }
        .accordion-content label { display: block; padding: 8px; cursor: pointer; font-size: 12px; border-bottom: 1px solid #eee; color: #333; }
        #fish-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); z-index: 30000; display: none; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; }
        .full-img-bg { max-width: 90%; max-height: 65vh; border: 4px solid #f39c12; border-radius: 15px 15px 0 0; object-fit: contain; background: #000; }
        .full-img-cond { max-width: 90%; height: auto; border: 4px solid #f39c12; border-top: none; border-radius: 0 0 15px 15px; background: white; }
        .footer-wiki { position: fixed; bottom: 0; left: 0; width: 100%; height: 50px; z-index: 3000; background: linear-gradient(90deg, #8b0000 0%, #d4af37 50%, #8b0000 100%); border-top: 2px solid #fff; display: flex; justify-content: center; align-items: center; }
        .wiki-link { text-decoration: none; color: white; font-weight: bold; font-size: 14px; }
        .menu-icon { width: 22px; height: 22px; vertical-align: middle; margin-right: 8px; border-radius: 50%; background: white; object-fit: contain; }
    </style>
</head>
<body>

<div id="intro-screen">
    <video id="intro-video" autoplay muted loop playsinline>
        <source src="heartopia.mp4" type="video/mp4">
    </video>
    <div class="welcome-box">
        <h1>Bienvenue sur Heartopia FR</h1>
        <p>Explorez notre Carte Interactive officielle.<br>PNJ, Bus et Guide de P√™che complet.</p>
        <button id="enter-button" onclick="startExperience()">üéÑ D√âCOUVRIR LA CARTE üéÑ</button>
    </div>
</div>

<div id="map"></div>

<div id="fish-overlay" onclick="closeFishOverlay()">
    <img id="overlay-bg" src="" class="full-img-bg">
    <img id="overlay-cond" src="" class="full-img-cond">
</div>

<div class="footer-wiki"><a href="https://jayibwi.wixsite.com/my-site-1" target="_blank" class="wiki-link">üìñ ACC√âDER AU WIKI FR üìñ</a></div>

<script>
    function startExperience() {
        document.getElementById('intro-screen').style.opacity = '0';
        document.getElementById('map').style.opacity = '1';
        setTimeout(() => { document.getElementById('intro-screen').style.display = 'none'; }, 1000);
    }

    setInterval(() => {
        const flake = document.createElement('div');
        flake.classList.add('snowflake');
        flake.innerHTML = '‚ùÑ';
        flake.style.left = Math.random() * 100 + 'vw';
        flake.style.animationDuration = (Math.random() * 3 + 2) + 's';
        flake.style.opacity = Math.random();
        document.body.appendChild(flake);
        setTimeout(() => flake.remove(), 5000);
    }, 150);

    var bounds = [[-1000, 0], [0, 1000]];
    var map = L.map('map', { crs: L.CRS.Simple, minZoom: 0, maxZoom: 3, zoom: 1, maxBounds: bounds });
    L.imageOverlay('carte.png', bounds).addTo(map);
    map.setView([-500, 500], 1);

    function createIcon(url, size = 70) { return L.icon({ iconUrl: url, iconSize: [size, size], iconAnchor: [size/2, size], popupAnchor: [0, -size/1.6] }); }
    var overlays = {};

    window.showFishOverlay = function(bg, cond) { 
        document.getElementById('overlay-bg').src = bg; 
        document.getElementById('overlay-cond').src = cond; 
        document.getElementById('fish-overlay').style.display = 'flex'; 
    };
    window.closeFishOverlay = function() { document.getElementById('fish-overlay').style.display = 'none'; };

    // --- PNJ ---
    var pnjData = [{pos:[-471,501], name:"Bob", icon:'pnj/bob.png'},{pos:[-526,499], name:"Atara", icon:'pnj/atara.png'},{pos:[-478,493], name:"Le Collectionneur", icon:'pnj/collectioneur.png'},{pos:[-469,488], name:"Doroth√©e", icon:'pnj/doroth√©e.png'},{pos:[-446,493], name:"Massimo", icon:'pnj/massimo.png'},{pos:[-412,418], name:"Ka Ching", icon:'pnj/ka ching.png'},{pos:[-399,591], name:"Andrew", icon:'pnj/andrew.png'},{pos:[-259,522], name:"Eric", icon:'pnj/eric.png'},{pos:[-456,549], name:"Vanya", icon:'pnj/vanya.png'},{pos:[-502,582], name:"Naniwa", icon:'pnj/niniwa.png'},{pos:[-502,519], name:"Joan", icon:'pnj/joa.png'},{pos:[-807,419], name:"Will", icon:'pnj/will.png'},{pos:[-355,809], name:"Patti", icon:'pnj/patti.png'},{pos:[-653,225], name:"Vernie", icon:'pnj/vernie.png'},{pos:[-498,526], name:"Bayley", icon:'pnj/bayley.png'}];
    pnjData.forEach(p => { 
        var g = L.layerGroup(); 
        L.marker(p.pos, {icon: createIcon(p.icon)}).addTo(g).bindPopup(p.name); 
        overlays[`<span class="pnj-id"><img src="${p.icon}" class="menu-icon"> ${p.name}</span>`] = g; 
    });

    // --- BUS ---
    var busData = [{pos:[-533,340], name:"Banlieue Ouest"},{pos:[-519,639], name:"Banlieue Village"},{pos:[-654,479], name:"Village P√™cheurs"},{pos:[-497,481], name:"Place Centrale"},{pos:[-500,798], name:"For√™t"}];
    busData.forEach(b => { 
        var g = L.layerGroup().addTo(map); 
        L.marker(b.pos, {icon: createIcon('bus.png', 85)}).addTo(g).bindPopup(b.name); 
        overlays[`<span class="bus-id"><img src="bus.png" class="menu-icon"> ${b.name}</span>`] = g; 
    });

    // --- POISSONS ---
    const fishList = [
        { name: "Ablette", bg: "poisson/ablette1.png", cond: "poisson/Lacs.png" },
        { name: "Acantharchus pomotis", bg: "poisson/Acantharchus_pomotis1.png", cond: "poisson/arcantharcus%20pomotis.png" },
        { name: "Aphyosemion striatum", bg: "poisson/Aphyosemion%20striatum.png", cond: "poisson/Aphyosemion%20striatum1.png" },
        { name: "Barbeau", bg: "poisson/barbeau1.png", cond: "poisson/barbeau.png" }
    ];
    fishList.forEach(f => {
        var html = `<span class="poisson-id" data-bg="${f.bg}" data-cond="${f.cond}">üêü ${f.name}</span>`;
        overlays[html] = L.layerGroup();
    });

    var layerControl = L.control.layers(null, overlays, {collapsed: false}).addTo(map);

    function setupAccordions() {
        var container = layerControl.getContainer();
        var allLabels = Array.from(container.querySelectorAll('label'));
        const sections = [
            { title: 'üë• PERSONNAGES', color: 'title-pnj', filter: 'pnj-id' },
            { title: 'üöå BUS', color: 'title-bus', filter: 'bus-id' },
            { title: 'üêü POISSONS', color: 'title-poisson', filter: 'poisson-id' }
        ];
        sections.forEach(sec => {
            var title = document.createElement('div');
            title.className = 'accordion-title ' + sec.color;
            title.innerHTML = sec.title + ' <span>‚ñº</span>';
            var content = document.createElement('div');
            content.className = 'accordion-content';
            allLabels.forEach(label => { 
                if (label.innerHTML.includes(sec.filter)) { 
                    content.appendChild(label); 
                    if (sec.filter === 'poisson-id') { 
                        label.onclick = () => {
                            let s = label.querySelector('.poisson-id');
                            showFishOverlay(s.dataset.bg, s.dataset.cond);
                        };
                    } 
                } 
            });
            container.appendChild(title); container.appendChild(content);
            title.onclick = () => {
                content.classList.toggle('active');
                title.querySelector('span').innerHTML = content.classList.contains('active') ? '‚ñ≤' : '‚ñº';
            };
        });
    }
    setTimeout(setupAccordions, 400);
</script>
</body>
</html>
